import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import statistics
from scipy import stats


### distances to the Small Magellanic Cloud and Large Magellanic Cloud in parsecs ###

DistSMC = 62440
DistLMC = 49590

### imported metadata from the OGLE III/II Catalogue of Cepheid Variables into pandaS dataframes ###

pd.options.display.max_rows = 99999

#I band LMC photometry dataframe

dfILMC = pd.read_csv ('cephlmcdata.csv')
dfILMC.columns =['ID', 'Mode', 'RA', 'Decl', 'I', 'P_1', 'dP_1', 'ID_OGLE_IV', 'REMARKS']

#I band SMC photometry dataframe

dfISMC = pd.read_csv ('cephsmcdata.csv')
dfISMC.columns =['ID', 'Mode', 'RA', 'Decl', 'I', 'P_1', 'dP_1', 'ID_OGLE_IV', 'REMARKS']


### data pre-processing - removing invalid datapoints by thresholding data using an Absolute Magnitude range and by removing NaN values ###

dfISMC = dfISMC.drop(dfISMC[dfISMC['I'] == (-99.99)].index)
dfILMC = dfILMC.drop(dfILMC[dfILMC['I'] == (-99.99)].index)

#dfISMC = dfISMC[dfISMC['I'] > 12]
#dfISMC = dfISMC[dfISMC['I'] < 22]

#dfILMC = dfILMC[dfILMC['I'] > 12]
#dfILMC = dfILMC[dfILMC['I'] < 22]

### SMC DISTANCE MODULUS CALCULATIONS AND DATA PROCESSING ###

#Absolute Magnitude Calculation of SMC Cepheid Variables

def MSMC(Imag): 
    return(Imag - 5*np.log10(DistSMC/10))

#Log(10) of the Fundamental mode Period (fundamental mode brightness fluctuation) of SMC Cepheid Variables

def PSMC(p):
    return(np.log10(p))


### LMC DISTANCE MODULUS CALCULATIONS AND DATA PROCESSING ###

#Absolute Magnitude Calculation of LMC Cepheid Variables

def MLMC(I): 
    return(I - 5*np.log10(DistLMC/10))

#Log(10) of the Fundamental mode Period (fundamental mode brightness fluctuation) of LMC Cepheid Variables

def PLMC(p):
    return(np.log10(p))

### P-L RELATIONSHIP GENERATION (CALIBRATION CURVES TO CALCULATE DISTANCE) ###

#SMC P-L relation calibration curve generated from SMC Cepheid Variables

y = ((MSMC(dfISMC['I'])).tolist())
x = ((PSMC(dfISMC['P_1'])).tolist())

plt.scatter(x, y)
a, b = np.polyfit(x, y, 1)
plt.xlabel('Log10 of Period(day)')
plt.ylabel('Abs I-band Mag')
LOBF = [i * a + b for i in x]
plt.plot(x, LOBF, color = "red")
plt.text(-0.6, -1.0, 'y = ' + format(a.round(2)) + 'x ' + format(b.round(2)))
plt.title('SMC P-L relationship')
plt.show()

#LMC P-L relation calibration curve generated from LMC Cepheid Variables

w = ((MLMC(dfILMC['I'])).tolist())
q = ((PLMC(dfILMC['P_1'])).tolist())

plt.scatter(q, w)
c, d = np.polyfit(q, w, 1)
plt.xlabel('Log10 of Period(day)')
plt.ylabel('Abs I-band Mag')
LOBF = [i * c + d for i in q]
plt.plot(q, LOBF, color = "red")
plt.text(-0.6, -1.0, 'y = ' + format(c.round(2)) + 'x ' + format(d.round(2)))
plt.title('LMC P-L relationship')
plt.show()

### Calculation of Distances to the SMC and LMC ###
#using SMC Cepheid variable period data ---> calculate absolute Magnitudes of SMC Cepheid variables ---> plug apparent magnitude and calculated absolute magnitude of Cepheid variables into distance modulus ---> find median of calculated distances
#using LMC Cepheid variable period data ---> calculate absolute Magnitudes of LMC Cepheid variables ---> plug apparent magnitude and calculated absolute magnitude of Cepheid variables into distance modulus ---> find median of calculated distances

#LMC P-L calibration curve: Calculating distances to SMC

def LMCPL(I, P):
    var1 = ((np.float64(c) * np.float64(np.log10(P))) + np.float64(d))
    var2 = ((I) - var1) / 5
    var3 = 10 * 10 ** var2
    return var3

dfISMC['dists'] = LMCPL(dfISMC['I'], dfISMC['P_1'])
medianSMCdist = statistics.median(dfISMC['dists'])

#SMC P-L calibration curve: Calculating distances to LMC

def SMCPL(I, P):
    var1 = ((np.float64(a) * np.float64(np.log10(P))) + np.float64(b))
    var2 = ((I) - var1) / 5
    var3 = 10 * 10 ** var2
    return var3

dfILMC['dists'] = LMCPL(dfILMC['I'], dfILMC['P_1'])
medianLMCdist = statistics.median(dfILMC['dists'])

### Results and %Error ###

def SMCperror(dist):
    print(dist)
    print(np.abs((dist - 62440) / 62440)*100)

def LMCperror(dist):
    print(dist)
    print(np.abs((dist - 49590) / 49590)*100)

SMCperror(medianSMCdist)
LMCperror(medianLMCdist)

print(np.quantile(dfISMC['I'], [0, 0.25, 0.5, 0.75, 1]))
print(np.quantile(dfILMC['I'], [0, 0.25, 0.5, 0.75, 1]))
